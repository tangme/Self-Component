function Ttag(t){var e=t.el,i=void 0===e?void 0:e,a=t.value,n=t.url,o=void 0===n?void 0:n,r=t.pattern,s=t.maxSize,d=void 0===s?0:s,l=t.items,c=void 0===l?[]:l,u=t.name,e=t.readonly,n=void 0!==e&&e,s=t.onCloseTag,l=void 0===s?void 0:s,e=t.onAddTag,s=void 0===e?void 0:e,e=t.onClickTag,e=void 0===e?void 0:e,t=t.onLoaded,t=void 0===t?null:t;i?(this.pattern=void 0===r?"&,&":r,this.editarea=document.querySelector(i),this.initDOM(u),this.selectArea=this.editarea.querySelector(".t-tag-select-item-con"),this.inputForm=this.selectArea.querySelector("input"),this.tag={_show:!1,items:c,readonly:n},this.hideSelTag=this.hideSelTag.bind(this),this.maxSize=d,this.onCloseTag=l,this.onClickTag=e,this.onAddTag=s,this.init(),a&&this.setData(a),o&&this.ajax({url:o,onLoaded:t})):console.error("el 参数不能为空！")}Ttag.prototype.ajax=function(t){var e=t.method,i=void 0===e?"post":e,a=t.url,e=t.data,n=t.onLoaded,t=t.flag,t=void 0===t||t,o=null,r=this,o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHttp");"GET"==i?(o.open(i,a+"?"+e,t),o.send()):"post"==i&&(o.open(i,a,t),o.setRequestHeader("Content-type","application/json"),o.send(e)),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&n&&n(o.responseText,r)}},Ttag.prototype.setData=function(t){if(Array.isArray(t))for(var e in t)this.addTag(t[e],!1)},Ttag.prototype.initDOM=function(t){var e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("autocomplete","off"),t&&e.setAttribute("name",t);t=document.createElement("div");t.setAttribute("class","t-tag-select-item-con close-ttag"),t.appendChild(e),this.editarea.appendChild(t)},Ttag.prototype.init=function(){var i=this;Object.defineProperties(this.tag,{show:{get:function(){return this._show},set:function(t){var e=i.selectArea.getAttribute("class");t?(e=e.replace("close-ttag",""),document.addEventListener("click",i.hideSelTag)):(e=e.concat("close-ttag"),document.removeEventListener("click",i.hideSelTag)),i.selectArea.setAttribute("class",e),this._show=t}},size:{get:function(){return i.inputForm.value.split(i.pattern).filter(function(t){return!!t}).length}}}),this.tag.readonly||(this.editarea.addEventListener("click",function(t){if(t.stopPropagation(),t.preventDefault(),"edit-item-del-con"===t.target.getAttribute("class")){var e=t.target.parentNode.querySelector(".edit-item-text").innerHTML;return i.delFormData(e),void t.target.parentNode.parentNode.removeChild(t.target.parentNode)}if("edit-item-del"===t.target.getAttribute("class")){e=t.target.parentNode.parentNode.querySelector(".edit-item-text").innerHTML;return i.delFormData(e),void t.target.parentNode.parentNode.parentNode.removeChild(t.target.parentNode.parentNode)}"edit-item-text"!==t.target.getAttribute("class")?(i.tag.items.length&&!i.tag.show&&(i.tag.show=!0),"t-tag-con"===t.target.getAttribute("class")&&i.newTag()):i.onClickTag&&i.onClickTag(t.target.textContent)}),this.selectArea.addEventListener("click",function(t){t.stopPropagation(),"t-tag-item"===t.target.getAttribute("class")&&i.addTag(t.target.innerHTML)}),this.loadItems())},Ttag.prototype.delFormData=function(t){t&&(this.inputForm.value=this.inputForm.value.replace(t+this.pattern,"")),this.onCloseTag&&this.onCloseTag(t)},Ttag.prototype.cleanItems=function(){var e=this,t=this.selectArea.querySelectorAll(".t-tag-item");(t=[].slice.call(t)).length&&t.forEach(function(t){e.selectArea.removeChild(t)})},Ttag.prototype.loadItems=function(t){this.cleanItems();var i,a=this;this.tag.items=t&&t.length?t:this.tag.items,this.tag.items.length&&(i=document.createDocumentFragment(),this.tag.items.forEach(function(t){a.pattern;var e=document.createElement("span");e.setAttribute("class","t-tag-item"),e.innerHTML=t,i.appendChild(e)}),this.selectArea.appendChild(i))},Ttag.prototype.getFormData=function(t){return"string"===(t=t||"string")?this.inputForm.value:this.inputForm.value.split(this.pattern)},Ttag.prototype.addTag=function(t,e){var i,a,n,o;this.maxSize&&this.tag.size>=this.maxSize||this.isDuplicate(t)||((i=document.createElement("li")).setAttribute("class","edit-item"),(a=document.createElement("span")).setAttribute("class","edit-item-text"),this.tag.readonly&&a.setAttribute("class","edit-item-text edit-item-text-readonly"),a.innerHTML=t,(n=document.createElement("span")).setAttribute("class","edit-item-del"),(o=document.createElement("span")).setAttribute("class","edit-item-del-con"),o.appendChild(n),i.appendChild(a),this.tag.readonly||i.appendChild(o),this.editarea.appendChild(i),this.inputForm.value=this.inputForm.value+t+this.pattern,this.onAddTag&&!1!==e&&this.onAddTag(t,this.inputForm.value,-1!==this.tag.items.indexOf(t)))},Ttag.prototype.isDuplicate=function(t){for(var e=!1,i=this.inputForm.value.split(this.pattern),a=0,n=i.length;a<n;a++)if(i[a]===t){e=!0;break}return e},Ttag.prototype.hideSelTag=function(){console.log("选择框隐藏"),this.tag.show=!1},Ttag.prototype.newTag=function(){var t,e,i=this;this.editarea.querySelector(".ttag-input")||((e=document.createElement("li")).setAttribute("class","edit-item input-edit-item"),(t=document.createElement("input")).setAttribute("class","ttag-input"),e.appendChild(t),this.editarea.appendChild(e),(e=this.editarea.querySelector(".ttag-input")).addEventListener("blur",function(){console.log("失去焦点"),this.value&&i.addTag(this.value),this.parentNode.parentNode.removeChild(this.parentNode),console.log("焦点移除")}),e.addEventListener("compositionstart",function(t){i.delFlag=!0}),e.addEventListener("compositionend",function(t){i.delFlag=!1}),e.addEventListener("keyup",function(t){13===t.keyCode&&(console.log("进入回车"),this.value&&(this.blur(),setTimeout(function(){console.log("回车重新聚焦"),i.editarea.click()})))}),e.addEventListener("keydown",function(t){8===t.keyCode&&(t.target.value.length||i.delFlag||(t=i.editarea.querySelectorAll(".edit-item:not(.input-edit-item)"),console.log(t),t.length&&(t=[].slice.call(t).pop(),i.delFormData(t.firstElementChild.textContent),i.editarea.removeChild(t))))}),e.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault()}),this.editarea.querySelector(".ttag-input").focus())};